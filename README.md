# 虚拟文件管理系统

## 项目简介

这是一个基于PyQt5开发的虚拟文件管理系统，模拟了操作系统的文件管理功能。系统采用虚拟文件系统（VFS）架构，所有文件数据存储在JSON格式的配置文件中，支持多用户权限管理、文件操作、系统监控等功能。

## 功能特性

### 核心功能
- **多用户权限管理**：支持管理员和普通用户，不同权限级别
- **虚拟文件系统**：基于JSON的虚拟文件存储，支持目录树结构
- **文件操作**：创建、删除、重命名、复制、剪切、粘贴文件/文件夹
- **文件编辑**：内置文本编辑器，支持文件内容编辑和保存
- **文件属性**：查看和修改文件属性，支持隐藏文件功能
- **搜索功能**：递归搜索文件和文件夹
- **文件排序**：按名称、大小、类型、修改时间排序
- **文件预览**：支持文本文件预览

### 高级功能
- **系统监控**：实时监控系统性能、磁盘使用、访问日志
- **文件缓存**：智能文件缓存机制，提高访问速度
- **文件索引**：自动建立文件索引，优化搜索性能
- **访问日志**：记录所有文件操作日志
- **系统健康检查**：监控系统运行状态

### 用户界面
- **现代化UI**：基于PyQt5的图形用户界面
- **树形目录**：左侧树形目录导航
- **列表视图**：右侧文件列表显示
- **工具栏**：常用操作快捷按钮
- **右键菜单**：上下文菜单操作
- **状态栏**：显示当前状态和文件统计

## 项目结构

```
可执行程序/
├── environment.yaml
├── README_EXE.md

源程序/
└── files/   └──/文件
    ├── main.py
    ├── requirements.txt
    ├── README.md
    ├── core/
    │   ├── __init__.py我愿以我的…
    │   ├── file_system.py
    │   └── system_monitor.py
    ├── ui/
    │   ├── __init__.py我愿以我的…
    │   ├── admin_window.py
    │   ├── login_window.py
    │   ├── system_monitor_dialog.py
    │   ├── user_management_dialog.py
    │   └── user_window.py
    ├── data/
    │   ├── __init__.py我愿以我的…
    │   ├── config.ini
    │   ├── filesystem.json
    │   ├── file_index.json
    │   ├── file_cache.json
    │   ├── system_log.json
    │   ├── users.json
    │   ├── (大量图标资源 *.png)
    │   └── template/│└——模板/
    │       └── __init__.py│└——__init__.py│└——__init__.py│└——__init__.py
    ├── utils/
    │   └── __init__.py│└——__init__.py│└——__init__.py│└——__init__.py
    └── __pycache__/

```

## 文件详细说明

### 核心模块 (core/)

#### file_system.py
虚拟文件系统的核心实现，包含以下主要功能：
- 文件系统数据管理（JSON格式）
- 文件/文件夹的增删改查操作
- 用户权限控制
- 路径解析和验证
- 文件内容读写
- 数据持久化

#### system_monitor.py
系统监控模块，提供以下功能：
- 系统性能监控（CPU、内存使用率）
- 磁盘使用统计
- 文件访问日志记录
- 文件缓存管理
- 文件索引维护
- 系统健康检查

### 用户界面模块 (ui/)

#### login_window.py
用户登录界面，功能包括：
- 用户登录验证
- 新用户注册
- 密码加密存储
- 登录状态管理

#### user_window.py
普通用户主界面，功能包括：
- 文件浏览器界面
- 文件操作工具栏
- 右键菜单操作
- 文件编辑对话框
- 搜索和排序功能
- 系统监控访问

#### admin_window.py
管理员主界面，继承用户界面功能，额外提供：
- 系统根目录访问权限
- 用户管理功能
- 系统信息查看
- 高级系统管理

#### user_management_dialog.py
用户管理对话框，提供：
- 用户列表显示
- 添加新用户
- 删除用户
- 修改用户权限

#### system_monitor_dialog.py
系统监控对话框，显示：
- 实时性能监控图表
- 磁盘使用情况
- 文件访问日志
- 系统健康状态

### 数据文件 (data/)

#### config.ini
系统配置文件，包含：
- 系统基本设置
- 界面配置参数
- 功能开关设置

#### filesystem.json
虚拟文件系统数据，存储：
- 完整的目录树结构
- 文件元数据信息
- 文件内容数据
- 创建和修改时间

#### users.json
用户数据文件，包含：
- 用户账号信息
- 密码哈希值
- 用户权限级别
- 用户创建时间

## 安装和运行

### 环境要求
- Python 3.7+   - Python 3.7
- PyQt5
- Windows 10/11 (推荐)

### 安装步骤

1. **安装Python环境**
   ```bash   ”“bash
   # 确保已安装Python 3.7或更高版本
   python --version
   ```

2. **安装依赖包**
   ```bash
   pip install PyQt5
   ```

3. **下载项目文件**
   - 将项目文件下载到本地目录
   - 确保文件结构完整

### 运行程序

1. **直接运行Python脚本**
   ```bash
   cd files
   python main.py
   ```

2. **运行可执行文件**
   ```bash
   # 进入可执行程序目录
   cd 可执行程序
   # 运行exe文件
   virtual_file_manager.exe
   ```

### 编译为可执行文件

如果需要重新编译exe文件：

1. **安装PyInstaller**
   ```bash
   pip install pyinstaller   安装pyinstaller
   ```

2. **编译程序**
   ```bash
   cd files
   pyinstaller --onefile --windowed --icon=data/kdFileFinder.png --name=virtual_file_manager main.py
   ```

## 使用说明

### 首次使用

1. **启动程序**
   - 运行main.py或exe文件
   - 程序会自动创建必要的配置文件和目录

2. **默认账号**
   - 管理员账号：admin / admin
   - 首次运行会自动创建此账号

3. **创建用户**
   - 使用管理员账号登录
   - 通过"用户管理"菜单创建新用户

### 基本操作

#### 文件操作
- **创建文件/文件夹**：右键菜单 → 新建
- **复制/剪切**：选中文件 → 右键菜单 → 复制/剪切
- **粘贴**：右键菜单 → 粘贴
- **删除**：选中文件 → 右键菜单 → 删除
- **重命名**：选中文件 → 右键菜单 → 重命名

#### 文件编辑
- **打开文件**：双击文件或右键菜单 → 打开
- **编辑内容**：在编辑对话框中修改内容
- **保存文件**：点击保存按钮

#### 搜索和排序
- **搜索文件**：工具栏搜索框输入关键词
- **文件排序**：点击列表标题进行排序
- **显示隐藏文件**：菜单栏 → 查看 → 显示隐藏文件

### 权限说明

#### 管理员权限
- 访问系统根目录
- 管理所有用户
- 查看系统监控
- 访问所有文件

#### 普通用户权限
- 访问个人主目录 (/home/用户名)
- 访问共享目录 (/home/shared)
- 管理个人文件
- 查看系统监控

### 系统监控

#### 性能监控
- CPU使用率
- 内存使用情况
- 系统运行时间

#### 磁盘使用
- 虚拟磁盘空间使用
- 文件数量统计
- 目录大小分析

#### 访问日志
- 文件操作记录
- 用户访问历史
- 权限验证日志

## 技术特点

### 虚拟文件系统
- 基于JSON的数据存储
- 树形目录结构
- 文件元数据管理
- 数据持久化

### 权限控制
- 基于用户的权限模型
- 路径级权限控制
- 操作权限验证
- 安全访问控制

### 性能优化
- 文件缓存机制
- 智能索引系统
- 异步操作支持
- 内存使用优化

### 用户界面
- 现代化设计
- 响应式布局
- 直观操作体验
- 丰富的交互功能

## 故障排除

### 常见问题

1. **程序无法启动**
   - 检查Python版本是否兼容
   - 确认PyQt5已正确安装
   - 检查文件路径是否正确

2. **文件保存失败**
   - 检查文件权限
   - 确认磁盘空间充足
   - 查看错误日志

3. **登录失败**
   - 确认用户名密码正确
   - 检查users.json文件完整性
   - 尝试重置密码

4. **文件显示异常**
   - 刷新文件列表
   - 检查filesystem.json文件
   - 重启程序

### 数据备份

重要数据文件：
- `files/data/filesystem.json` - 虚拟文件系统数据
- `files/data/users.json` - 用户数据
- `files/data/config.ini` - 系统配置

建议定期备份这些文件。

## 开发说明

### 代码结构
- 模块化设计，前后端分离
- 清晰的类层次结构
- 完善的错误处理
- 详细的代码注释

### 扩展开发
- 支持插件式功能扩展
- 模块化架构便于维护
- 标准化的接口设计
- 完整的文档支持

## 版本历史

- **v1.0** - 基础文件管理功能
- **v1.1** - 添加用户权限管理
- **v1.2** - 实现系统监控功能
- **v1.3** - 优化用户界面和性能
- **v1.4** - 添加高级功能和工具

## 许可证

本项目仅供学习和研究使用。

## 联系方式

如有问题或建议，请联系开发团队。

## 设计思想说明

### 1. 整体设计理念

#### 虚拟化思想
本系统采用**虚拟文件系统（VFS）**的设计理念，将传统的文件系统操作抽象化，在应用层实现完整的文件管理功能。这种设计具有以下优势：

- **安全性**：所有操作都在虚拟环境中进行，不会影响真实的文件系统
- **可移植性**：数据以JSON格式存储，便于跨平台迁移
- **可扩展性**：虚拟层可以轻松添加新的文件系统特性
- **学习价值**：帮助理解真实文件系统的工作原理

#### 模块化架构
系统采用**分层模块化**的设计思想，将功能按职责分离：

```
┌─────────────────────────────────────┐
│           用户界面层 (UI)            │  ← 用户交互
├─────────────────────────────────────┤
│           业务逻辑层 (Core)          │  ← 核心功能
├─────────────────────────────────────┤
│           数据存储层 (Data)          │  ← 数据持久化
└─────────────────────────────────────┘
```

### 2. 核心设计原则

#### 2.1 单一职责原则 (SRP)
每个模块和类都有明确的职责：
- **FileSystem类**：专门负责文件系统操作
- **SystemMonitor类**：专门负责系统监控
- **UI类**：专门负责用户界面交互

#### 2.2 开闭原则 (OCP)
系统设计支持扩展，对修改封闭：
- 新的文件操作类型可以通过继承现有类实现
- 新的监控指标可以通过插件方式添加
- 新的用户界面可以通过配置方式定制

#### 2.3 依赖倒置原则 (DIP)
高层模块不依赖低层模块，都依赖抽象：
- UI层通过接口调用Core层功能
- Core层通过抽象接口访问数据层
- 便于单元测试和模块替换

### 3. 数据设计思想

#### 3.1 树形结构设计
文件系统采用**树形目录结构**，模拟真实文件系统：

```json
{
  "root": {
    "children": [
      {
        "name": "home",
        "children": [
          {
            "name": "user1",
            "children": [
              {
                "name": "document.txt",
                "type": "file",
                "content": "文件内容"
              }
            ]
          }
        ]
      }
    ]
  }
}
```

**设计优势**：
- **层次清晰**：目录结构直观易懂
- **操作高效**：树形结构便于遍历和查找
- **扩展性好**：支持无限层级的目录嵌套

#### 3.2 元数据设计
每个文件/目录都包含完整的元数据信息：

```python
{
    "name": "文件名",
    "type": "file|dir",
    "path": "/完整路径",
    "created": "创建时间",
    "modified": "修改时间",
    "content": "文件内容",
    "size": 文件大小,
    "hidden": 是否隐藏,
    "children": []  # 目录的子项
}
```

**设计考虑**：
- **完整性**：包含文件系统需要的所有信息
- **一致性**：统一的数据格式便于处理
- **可追溯性**：时间戳支持操作历史追踪

### 4. 权限设计思想

#### 4.1 基于路径的权限模型
采用**路径级权限控制**，确保用户只能访问授权区域：

```python
def check_access_permission(user, path):
    if user == "admin":
        return True  # 管理员拥有所有权限
    elif path.startswith(f"/home/{user}"):
        return True  # 用户可以访问自己的主目录
    elif path.startswith("/home/shared"):
        return True  # 用户可以访问共享目录
    else:
        return False  # 其他路径无权限
```

**设计特点**：
- **简单明确**：权限规则清晰易懂
- **安全可靠**：严格的路径检查
- **易于扩展**：可以轻松添加新的权限规则

#### 4.2 最小权限原则
用户默认只拥有必要的权限，需要时再授予额外权限：
- 普通用户只能访问个人目录和共享目录
- 管理员拥有系统级权限
- 权限检查贯穿所有操作

### 5. 性能设计思想

#### 5.1 缓存策略
实现**多级缓存机制**，提高系统性能：

```python
# 文件内容缓存
file_cache = {
    "file_path": "cached_content",
    "timestamp": "cache_time"
}

# 路径索引缓存
path_index = {
    "file_name": "full_path",
    "parent_path": "children_list"
}
```

**缓存层次**：
1. **内存缓存**：最近访问的文件内容
2. **索引缓存**：文件路径快速查找
3. **配置缓存**：系统设置参数

#### 5.2 延迟加载
采用**按需加载**策略，减少内存占用：
- 文件内容只在需要时读取
- 目录结构按需展开
- 监控数据实时计算

### 6. 用户体验设计思想

#### 6.1 直观性设计
界面设计遵循**直观易用**的原则：
- 树形目录结构清晰显示
- 文件列表详细展示信息
- 操作按钮位置合理

#### 6.2 一致性设计
保持**操作一致性**：
- 统一的右键菜单
- 一致的快捷键设置
- 相同的操作流程

#### 6.3 反馈性设计
提供**及时的操作反馈**：
- 操作成功/失败提示
- 进度条显示
- 状态栏信息更新

### 7. 可扩展性设计思想

#### 7.1 插件化架构
系统支持**功能插件**扩展：
- 新的文件操作类型
- 额外的监控指标
- 自定义界面主题

#### 7.2 配置化设计
通过**配置文件**控制系统行为：
- 界面显示选项
- 性能参数设置
- 安全策略配置

### 8. 安全性设计思想

#### 8.1 数据验证
所有输入数据都进行**严格验证**：
- 路径格式检查
- 文件名合法性验证
- 内容长度限制

#### 8.2 错误处理
完善的**异常处理机制**：
- 优雅的错误恢复
- 详细的错误日志
- 用户友好的错误提示

### 9. 学习价值设计思想

#### 9.1 教学导向
系统设计注重**教学价值**：
- 模拟真实文件系统操作
- 展示文件系统核心概念
- 提供实践操作机会

#### 9.2 透明性设计
系统内部**透明可见**：
- 数据结构清晰展示
- 操作过程可追踪
- 性能指标实时监控

### 10. 总结

本虚拟文件管理系统的设计思想体现了以下核心理念：

1. **教育性**：通过虚拟化技术帮助理解文件系统原理
2. **实用性**：提供完整的文件管理功能
3. **安全性**：严格的权限控制和数据验证
4. **可扩展性**：模块化设计支持功能扩展
5. **用户友好**：直观的界面和流畅的操作体验

这种设计思想不仅满足了课程设计的要求，也为进一步的学习和研究提供了良好的基础。

---

**注意**：本系统为虚拟文件管理系统，所有文件数据存储在本地JSON文件中，不会影响实际的文件系统。 
